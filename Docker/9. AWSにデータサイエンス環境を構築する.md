# 1. AWSへの登録
* 登録
* EC2の無料インスタンスを立てる
    * EC2 ⇒ インスタンスを起動 ⇒ 無料枠の Ubuntu Serverを選択 ⇒ t2.micro
    * 次のステップ ⇒ デフォルトのまま次のステップを繰り返す ⇒ タグのところはキー:mydocker、タグ:dsenvと適当に入力
    * セキュリティは、タイプを全てのトラフィックに変更 ⇒ 確認と作成
    * 新しいキーペアの作成 ⇒ キーペア名をmydocker2に変更 ⇒ インスタンスの作成をクリック
* インスタンスの状態がrunningになると課金開始

# 2. AWSのインスタンスにSSHでアクセスする

* chmod 400 <file>でパーミッションを変更
* 4:read, 2:write, 1:excute, 0:no permission。
* 全権限なら4+2+1=7
    * 「所有者」⇒「所有グループ」⇒「その他」の3つを順に指定

```sh
# 自分だけ読めるように設定
chmod 400 mydocker.pem
```

```sh
# sshでログイン
ssh -i mydocker.pem ubuntu@<Public DNS名>
```

# 3. AWSのインスタンスにDockerをセットアップする
```sh
# SSHログインした状態で以下を実行
sudo apt-get update
# dockerをインストール
sudo apt-get install docker.io
# 今のままだとdockerコマンドを使用する前に sudo が必要
# 以下で docker groupを作って、ubuntuに所属させて、sudoを不要に設定
sudo gpasswd -a ubuntu docker
# 一度ログアウト
exit
# 再度ログイン
ssh -i mydocker.pem ubuntu@<public DNS名>
# dockerコマンドが通ることを確認
docker images 
```

# 4. Docker imageをAWSのインスタンスにアップロードする
* Dockerfileを送る: 一般的に使われる方法
* Docker imageをtarにして送る: Imageを送るので、インターネットに接続しなくても環境作成可能

```Dockerfile
# 適当なDockerfileを作成
From alpine
RUN touch test
```

```sh
cd 9-1
docker build .
docker images
# tarファイルを作成
docker save ImageID > myimage.tar
```

# 5. SFTPを使ってファイルを転送する

```sh
# SFTP（Secure File Transfer Protocol)でログイン
sftp -i mydocker.pem ubuntu@<public DNS名>
# ファイルのアップロード、アップロード先は/home/ubuntu
put C:/Users/xxx/study-records/Docker/9/9-1/myimage.tar /home/ubuntu
```