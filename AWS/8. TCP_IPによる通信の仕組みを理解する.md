# 1. TCP/IPとは
* TCP/IPでは4層の役割がある
* アプリケーション層: ソフトウェア同士が会話する
    * HTTP/SSH/DNS/SMTP
* トランスポート層: データのやり取りの順番を制御したり、エラー訂正したりするなど、信頼性を高めたデータの転送を制御する
    * TCP/UDP
* インターネット層: IPアドレスの割り当て、ルーティングをする
    * IP/ICMP/ARP
* インターフェース層: ネットワーク上で接続されている機器同士で通信する
    * Ethernet/PPP
* 階層化されている理由は、各階層を独立させるため
    * 上位や下位の階層の内容はわからなくてもよいという構造になっている

## 名前解決で何が起きているか
* アプリケーション層
    * ブラウザがドメイン名を抜き出し、名前解決しようとする
    * DNSサーバーに対して名前解決の処理を依頼する為、DNSプロトコルで定められたフォーマットに従い、名前解決のリクエストデータを作成
* トランスポート層
    * UDPでカプセル化（封筒に入れるイメージ）
        * 封筒で物を送るときは中身が分からなくても送ることができる
        * カプセル化もこれと同様に、中身に手を加えず、下の階層で処理ができるようにデータを送付する
    * トランスポート層はTCP(Transmission Control Protocol) or UDP(User Datagram Protocol)
        * DNSではUDPを使うことになっている
    * 送信元のポート番号、宛先ポート番号、データの長さ、エラーがないかどうかを調べるチェックサム　等の情報が追加される
        * DNSの場合は宛先ポート番号は53
* インターネット層
    * IPでカプセル化
    * 送信元IPアドレス、宛先IPアドレス、データ長、生存時間などの情報が追加される
        * これらをIPヘッダーという
        * 生存時間は何回ルーターを通ったら破棄するかという値。これにより、無限に行ったり来たりするのを防ぐ
* インターフェース層
    * Ethernetでカプセル化
    * Ethernetでは先頭と語尾にいくつかのデータが追加される(Ethernetフレーム)
        * Ethernetフレームには、送信元MACアドレス、宛先MACアドレスなどの情報が含まれる
        * パソコン、サーバー、各種ネットワーク機器にはMACアドレスという唯一の番号が振られている
        * MACアドレスはメーカーの工場出荷時に重複が無いように定められる
    * EthernetではMACアドレスを頼りにデータを送信する
        * どのMACアドレスがどのIPに対応しているのかわからないが、これを解決するのがARP(Address Resolution Protocol)
        * 10.0.1.10というIPアドレスはだれかと問い合わせる(ARP要求)
            * ⇒ そのIPアドレスを持っているホストがMACアドレスを回答する(ARP回答)
        * ARPはルーターを超えることはできない（自分が所属するサブネット内にとどまる）
            * ルーターを超える場合はそのルーターまでEthernetで届ける
            * 受け取ったルーターはそのパケットのIPまでを取り出し、再びEthernetヘッダーをつけて送出する

# 2. UDPとTCP
* TCP/IPで通信する場合、トランスポート層にはUDPとTCPの2種類ある
* UDPは「ステートレスプロトコル」と呼ばれる状態を持たないプロトコル
    * UDPは単純で「送信元ポート番号」「宛先ポート番号」のほかには、「データの長さ」と「チェックサム」しかない
    * UDPは送りっぱなしのプロトコルで、相手が受け入れ態勢が整ってなくても再送されない
        * 受け取ったかどうかも確認できない
        * パケットの到着順序も保証されず、後から送付したパケットが先に届くこともある
        * 一方で、高速に送信可能なので、以下のケースに適している
            * データが1パケットに収まる場合や、パケットが前後してもよい場合、返答が無くても再度処理すればよい場合
* TCP(Transmission Control Protocol)
    * アプリケーションによっては高い信頼性を必要とする
        * Webブラウザで入力したデータをHTTP経由でWEBサーバーに送りデータベースに格納する場合など
    * TCPでは通信相手との間にコネクションを確立する
        * 3ウェイハンドシェークと呼ばれており、「もしもし」「はい聞こえています」「OKですね」というやり取りをしている状態
            * SYN: 通信を開始したいことを表す信号 をまず相手に送る
            * 相手から ACK: 受領の合図を示す とSYNが返ってくる
            * 相手にACKを返す
        * TCPでは、パケットにシーケンス番号（通し番号）をつけてやり取りしている
            * ACKでは次にほしいシーケンス番号を返すので、順序が正しくなかった場合は再送してもらうことができる
            * 送信側も応答番号を確認することで、相手に届いたか確認できる